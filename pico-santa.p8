pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
poke(0x5f2c, 3)

make_parallax = function(x, y, speed, frame, width, height, wrap)
    local self = {
        x = x,
        y = y,
        speed = speed,
        frame = frame,
        width = width,
        height = height,
        wrap = wrap,
        original_x = x
    }

    function self.update()
    end

    function self.draw()
        local wrap = self.wrap and (8 / self.width) or 0
        for _x=0, wrap do
            spr(self.frame, self.x+(_x*(self.width * 8)), self.y, self.width, self.height)
        end
    end

    return self
end

make_player = function(x, y)
    local self = {
        x = x,
        y = y,
        init_y = 0,
        init_x = 0,
        dy = 0,
        frame = 1,
        animate = 0,
        moving = false,
        jumping = false,
        left = false,
        state = "idle",
    }

    function self.update()
        -- left btn
        if btn(0) and self.state == "idle" then
            self.left = true
            self.state = "moving"
            self.direction = "left"
        end

        -- right btn
        if btn(1) and self.state == "idle" then
            self.left = false
            self.state = "moving"
            self.direction = "right"
        end

        -- movement
        if self.state == "moving" then
            if self.direction == "right" then self.x += 1 end
            if self.direction == "left" then self.x -= 1 end

            if self.x % 8 == 0 then
                self.moving = false
                self.state = "idle"
            end
        end

        -- up btn
        if (btn(5) or btn(2)) and self.state == "idle" then
            self.state = "jumping"
            self.init_y = self.y
            self.direction = "up"
        end

        -- jump movement
        if self.state == "jumping" then
            if self.direction == "up" then
                self.y -= 1
            end

            if self.direction == "down" then
                self.y += 1
            end

            if self.init_y - self.y == 8  and self.direction == "up" then
                self.direction = "down"
            end

            if self.direction == "down" and self.y == 48 then
                self.state = "idle"
            end
        end

        debug = self.y

        -- auto touch
        if self.x == 32 and self.y == 40 then
            self.state = "auto"
            self.init_x = self.x
            self.init_y = self.y
        end

       -- auto movement
       if self.state == "auto" then
            if self.y != (self.init_y) then
                self.y -= 1
            elseif self.x != (self.init_x + 8) then
                self.x += 1
            else
                self.state = "idle"
            end
       end

       if self.state != "idle" and step % 2 == 0 then
           self.animate = (self.animate + 1) % 2
       end
    end

    function self.draw()
        spr(self.frame + self.animate, self.x, self.y, 1, 1, self.left)
    end

    return self
end

function _init()
    debug = ""
    step = 0

    mountains = make_parallax(-10, 20, 0, 64, 8, 4, true)
    clouds = make_parallax(0, 24, 0, 72, 8, 6, true)
    sun = make_parallax(0, 0, 0, 28, 2, 2, false)

    player = make_player(0,48)
end

function _update()
    step += 1

    player:update()
end

function _draw()
    cls(12)

    mountains:draw()
    clouds:draw()
    sun:draw()

    map(0, 0, 0, 0, 16, 16)

    player:draw()

    print(debug, 0, 0, 7)
end

__gfx__
0000000077888880778888800000000000000000000000000000000007777777777777777777777000000066660000000dddddddddddddddddddddd000000000
0000000077e8888077e88880033333000333330000666660006666607777777777777777777777770000666666660000dddddddddddddddddddddddd00000000
0070070000f5ff5000f5ff50033838000338380000686860006868607777777777777777777777770006665555666000dddddddddddddddddddddddd00000000
0007700000f5ff5000f5ff50003838000038380000686800006868007776776776677677767767770006655555566000ddd6dd6dd66dd6ddd6dd6ddd00000000
000770000077777700777777003333000033330000dddd0000dddd007666666666666666666666670006655555566000d6666666666666666666666d00000000
007007000087755700877557003333000033330000dddd0000dddd006666666666666666666666660006655555566000d6666666666666666666666d00000000
000000000088888800888888003333000033330000dddd0000dddd006666666666666666666666660006655555566000d6666666666666666666666d00000000
00000000002228220088222800550550000550000066d66000d6660066666666666666666666666600066555555660000dddddddddddddddddddddd000000000
333000000005555500055555000000000000000000000000000000007777777777777777777777700000dddddddd000000000000000000000000000000000000
0bbb000000000505000005050000000000000000000000000000000077777777777777777777777700dddddddddddd0000000ffffff000000000000000000000
3330000040044444400444440bbbbb880bbbbb8888999990889999907777777777777777777777770dddaaddddaaddd0000ffffffffff0000000000000000000
3333000044444454444444540bbbb0880bbbb08888099990880999907667767777777777777777770ddaaaddddaaadd000ffffffffffff000000000000000000
23333022444440444444404405f5f00005f5f000000f5f50000f5f506666666677777777777777770ddaaaddddaaadd000ffffffffffff000000000000000000
2222224244444048444440480ffff0000ffff000000ffff0000ffff06666666677777777777777770ddaaaddddaaadd00ffffffffffffff00000000000000000
2444444249999000499990000bbbb0000bbbb00000099990000999906666666677777777777777770ddaaaddddaaadd00ffffffffffffff00000000000000000
22222220550550000555000088b880000b88b000000889880009889066666666ddddddddddddddd00ddaaaddddaaadd00ffffffffffffff00000000000000000
0003300000000000000000000000000000000000666666666666666677777777777777770000000000000000666666660ffffffffffffff00000000000000000
0033330000000000000000000044440000444400655555555555555677777777777777770077880000887700666666760ffffffffffffff00000000000000000
00333300088998800bb88bb00444444404444444577777777777777577777777774277420777888008887770666666660ffffffffffffff00000000000000000
03333330088998800bb88bb0444454454444544557666666666666d5677687677427764607778880088877706666666600ffffffffffff000000000000000000
033333300999999008888880444444544444445457666666666666d5666677666426664608887770077788806666666600ffffffffffff000000000000000000
333333330999999008888880444444444444444457666666666666d56666786664266646088877700777888066766666000ffffffffff0000000000000000000
33333333088998800bb88bb0444444004444440057666666666666d5666688666444444600887700007788006666666600000ffffff000000000000000000000
00044000088998800bb88bb0444044000444400057666666666666d5666688666426664600000000000000006666666600000000000000000000000000000000
000000000000000000000000000000000000000057666666666666d5666687666426664600000000000000000000000000000000000000000000000000000000
000000000000000000000000000000d0000000d057666666666666d5666677666426664609988990088bb8800000000000000000000000000000000000000000
0000000009988990088bb880000000d0000000d057666666666666d5666678666444444609988990088bb8800000000000000000000000000000000000000000
0000000009988990088bb880660066d0000066d057666666666666d57766886664266646088888800bbbbbb00000000000000000000000000000000000000000
00000000088888800bbbbbb0666666660006666657666666666666d57866886664266646088888800bbbbbb00000000000000000000000000000000000000000
00000000088888800bbbbbb0666665650066656557666666666666d5888877666426664609988990088bb8800000000000000000000000000000000000000000
0000000009988990088bb880066666566066665657666666666666d5688776666444444609988990088bb8800000000000000000000000000000000000000000
0000000009988990088bb88000666666666666665dddddddddddddd5666666666426664600000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000ddd00000000000000000000000ddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000dddd000000000000000000000ddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000ddddd000000000000000000ddddddd0000000000000000000ddd00000000000000000000000000000000000000000000000000000000000000000000000
0000ddddddd0000000000000001dddddddd000000000000000000dddd00000000000000000000000000000000000000000000000000000000000000000000000
000ddddddddd000000000000011ddddddddd000000000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000
000dddddddddd0000000000011ddddddddddd00000000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000
00dddddddddddd000000000011dddddddddd11100000000000ddddddd00000000000000000000000000000000000000000000000000000000000000000000000
00dddddddddd1100000000111111ddd111dd111100000000001dd11dd00000000000000000000000000000000000000000000000000000000000000000000000
001ddddddd1111110000011111111111111111111000000001111111110000000000000000000000000000000000000000000000000000000000000000000000
011dddddd11111110011111111111111111111111100000001111111110000000000000000000000000000000000000000000000000000000000000000000000
111d111d111111111111111111111111111111111110000111111111110000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111101111111111111000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111100110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111101110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
111111111111111111111111111111111111111111111111111111111111111100000ddddd000000000000000000000000000000000000000000ddddddd00000
11111111111111111111111111111111111111111111111111111111111111110000dddddddd000000000000dddddd0000000000000000000dddddddddddd000
11111111111111111111111111111111111111111111111111111111111111110ddddddddddddd00000000dddddddddd000000000ddddd00ddddddddddddddd0
1111111111111111111111111111111111111111111111111111111111111111ddddddddddddddd00000ddddddddddddddddd000dddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111ddddddddddddddddd00ddddddddddddddddddddddddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
1111111111111111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000011111111111111111111111111000011111111111111111111111111111dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000111000000000000000000000000001110000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000000000000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000000000cccccccccc0000000000000000000000cccccccccc000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
000000cccccccccccccccccc00000000000000cccccccccccccccccc00000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
000000cccccccccccccccccc0000000000000cccccccccccccccccccc0000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc00000000000cccccccccccccccccccccc000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc00000000000cccccccccccccccccccccc000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccc333cccc333cccc0000000000cccccccc333cccc333cccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccc333cccc333cccc0000000000cccccccc333cccc333cccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccc333cccc333cccc0000000000cccccccc333cccc333cccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccc333cccc333cccc0000000000cccccccc333cccc333cccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccc333cccc333cccc0000000000cccccccc333cccc333cccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccc333cccc333cccc0000000000cccccccc333cccc333cccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000cccccccccccccccccccc0000000000cccccccccccccccccccccccc00000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111111111111111111111111111111111111111111111111111111111111111
0000ccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00c1111111111111111111111111111111111111111111111111111111111111111
0000ccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00c1111111111111111111111111111111111111111111111111111111111111111
0000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111111111111111111111111111111111111111111111111111111111111111
00000ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111111111111111111111111111111111111111111111111111111111111111
0000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111111111111111111111111111111111111111111111111111111111111111
0000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111111111111111111111111111111111111111111111111111111111111111
0000000000000000000cccccc0000000000000000000cccc00000000000ccccc1111111111111111111111111111111111111111111111111111111111111111
00000000000000000000cccc000000000000000000000cccc0000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000cccc000000000000000000000cccc0000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000cccc0000000000000000000000ccc0000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000cccc0000000000000000000000ccc0000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000002113000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000728080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002b382b2b25000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002b382b2b35000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
