pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- player class
player = {}

player.new = function(x, y)
  local self = {}
  self.x = x or 0
  self.y = y or 0
  self.frame = 1
  self.flipx = false
  self.flipy = false
  self.step = 0

  self.update = player.update
  self.draw = player.draw

  return self
end

player.update = function(self)
  self.step += 1

  if self.step % 10 == 0 then
    self.frame += 1
  end

  if self.frame == 3 then
    self.frame = 1
  end

  if btn(0) then -- left
    self.flipx = true
    self.x -= 1
  end

  if btn(1) then -- right
    self.flipx = false
    self.x += 1
  end

  if btn(2) then -- up
    self.y -= 1
  end

  if btn(3) then -- down
    self.y += 1
  end

  if btn(4) then -- x
    self.frame = 0
  end

  if btn(5) then -- z
    self.frame = 0
  end
end

player.draw = function(self)
  spr(self.frame, self.x, self.y, 1, 1, self.flipx, self.flipy)
  spr(self.frame+16, self.x, self.y+8, 1, 1, self.flipx, self.flipy)
end

-- world class
world = {}

world.new = function()
  local self = {}

  self.levels = {}
  self.levels[1] = { 0, 0, 0, 0, 8, 8 }
  self.levels[2] = { 8, 0, 0, 0, 8, 8 }
  self.levels[3] = { 16, 0, 0, 0, 8, 8 }
  self.levels[4] = { 24, 0, 0, 0, 8, 8 }
  self.levels[5] = { 0, 8, 0, 0, 8, 8 }
  self.levels[6] = { 16, 8, 0, 0, 8, 8 }
  self.levels[7] = { 0, 16, 0, 0, 8, 8 }
  self.current = 1

  self.update = world.update
  self.draw = world.draw

  return self
end

world.update = function(self)
  if self.current == 1 and trevon.x > 60 then
    self.current = 2
    trevon.x = 0
  end

  if self.current == 2 and trevon.x < -5 then
    self.current = 1
    trevon.x = 60
  end

  if self.current == 2 and trevon.x > 60 then
    self.current = 3
    trevon.x = 0
  end

  if self.current == 3 and trevon.x < -5 then
    self.current = 2
    trevon.x = 60
  end

  if self.current == 3 and trevon.x > 60 then
    self.current = 4
    trevon.x = 0
  end

  if self.current == 4 and trevon.x < -5 then
    self.current = 3
    trevon.x = 60
  end

  if self.current == 4 and trevon.x > 20 then
    self.current = 5
    trevon.x = 0
    trevon.y = 45
  end

  if self.current == 5 and trevon.x < -5 then
    self.current = 4
    trevon.y = 10
    trevon.x = 15
  end

  if self.current == 5 and trevon.x > 60 then
    self.current = 6
    trevon.x = 0
  end

  if self.current == 6 and trevon.x < -5 then
    self.current = 5
    trevon.x = 60
  end

  if self.current == 6 and trevon.x > 50 then
    self.current = 7
  end

  if self.current == 7 and (trevon.x > 60 or trevon.x < -5) then
    self.current = 6
    trevon.x = 45
    trevon.y = 45
  end
end

world.draw = function(self)
  map(
    self.levels[self.current][1],
    self.levels[self.current][2],
    self.levels[self.current][3],
    self.levels[self.current][4],
    self.levels[self.current][5],
    self.levels[self.current][6]
  )

  pset(rnd(60), rnd(60), 7)
  pset(rnd(60), rnd(60), 7)
  pset(rnd(60), rnd(60), 7)
end

-- pico

function _init()
  poke(0x5f2c, 3)
  music(1)
  trevon = player.new(0,40)
  level = world.new()
end

function _update()
  trevon:update()
  level:update()
end

function _draw()
  cls()
  level:draw()
  trevon:draw()
end


__gfx__
000440000004400000044000ffffffffccccffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdddddddd
f004400f000f3000000f3000fffffffffccfcfffffffffffffffffffffffffffffffffffffffffdddddddddddddddddddddddddddddddddddddddddddd111111
800440080004f0000004f000ffffffffffcffffffffffff5fffffffffffffffffffffffffffffdddddddddddddddddddddddddddddddddddddddddddd1111111
800440080004400000044000ffffff555555ffffffffff55fffffffffffffffffffffffffffffdddddddddddddddddddddddddddddddddddddddddddd1111111
808888080008800000088000ffff555555555fffffffff55ff555fffffffffffffffffffddfffdddffddfffdddddddddddddddddddddddddddddddddd1111111
888888880088880000888800ffff5557555555ffffffff555555ffffffffffffffffffffddfffdddffddfffddddfffffddddffffdddfffffddddffffd1111111
008888000088880000888800fff575555555555ffffffff555ffffffffffffffffffffffddfffddddddddddddddfffffddddffffdddfffffddddffffd1111111
008880000088880000888800fff55555555555555fffff5555ffffffffffffffffffffffddfffdddddddddddddddddddddddddddddddddddddddddddd1111111
008880000088880000888800fff6666665555555555555555fffffffffffffffffffffffddfffddddddddddddddddddddddddddddddddddddddddddddddddddd
00888000008cc800008cc800ff6666666555555555555555cfffffffffffffffffffdddddddddddddddddddddddddddddddddddddddddddddddddddd111111dd
00888000008cc000008c0c00ff6666666655555cccccc5ccccccccccffffffffffffdddddddddddddddddddddddddddddddddddddddddddddddddddd1111111d
00ccc000000cc000000c0c00ccccccccccccccccccccccccccccccccffffffffffffdddfffdddffffdddffddddffffdddfffdddfffdddffffdddffff1111111d
00c0c000000cc000000c0c00ccccccccccccccccccccccccccccccccfffffffffffddddfffdddffffdddffddddffffdddfffdddfffdddffffdddffff1111111d
00c0c000000cc000000c0c00ccccccccccccccccccccccccccccccccfffffffffffddddddddddddddddddddddddddddddddddddddddddddddddddddd1111111d
004040000004400000040400ccccccccccccccccccccccccccccccccfffffffffffddddddddddddddddddddddddddddddddddddddddddddddddddddd1111111d
004040000004400000040400ccccccccccccccccccccccccccccccccfffffffffffddddddddddddddddddddddddddddddddddddddddddddddddddddd1111111d
66666666cccccccccccccccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd11ddddddddddddddddddddddd11111111
66666666ccccccccccccccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd1111dddddddddddddddddddddd11111111
66666666cccccccccccccccccccccccccccccccccccccccccccccccccccddddddddddddddddddddddddddddddddddd1111dddddddddddddddddddddd11111111
66666666ccccccccccc7777ccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd111111ddddddddddddddddddddd11111111
66666666ccccccccc77ccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd111111ddddddddddddddddddddd11111111
66666666cccccccccccccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd111111ddddddddddddddddddddd11111111
66666666cccccccccccccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd111111ddddddddddddddddddddd11111111
66666666cccccccccccccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddd111111ddddddddddddddddddddd11111111
fff777fffffffffffffffffeeeeeeeeeefffffffefffffff00000000cccccdddddddddddddddddddddddddddddddd111111ddddddddddddddddddddd00000000
f777777fffffffffffffffeeeeeeeeeeefffffffefffffff00000000cccccccccccddddddddddddddddddddddddddddddddddddddddddddddddddddd00000000
77777777fffffffffffffeeeeeeeeeeeeeffffffefffffff00000000cccccccccccccccccccccccccccccccccccddddddddddccccccccccccccccccc00000000
77777777ffffffffffffeeeeeeeeeeeeeeeeefffefffffff00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000
77777777fffffffffffeeeeeeeeeeeeeeeeeeeefeeefffff00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000
7777777ffffffffffeeeeeeeeeeeeeeeeeeeeeefeeeeffff00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000
f777777fffffffffeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000
ff7777ffffffffffeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000
__map__
313234313132353131313131313031313133343131310708090a0b0c0d0e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
323333343233333432353131313131313233333431311718191a1b1c1d1e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
212121212121212121212121212121212121212121212728292a2b2c2d2e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
212121212121212121212121212121212121212120202020202020203d3e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121202021212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121212121212121212121212121212121212121202021212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202020202020202021212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202020202020202021212121212121210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2929292929292929292929292929292929292929292929292900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2929292929292929292929292929292929292929292929292900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2931323129293031312929313131292931323429292929292900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2932333429293131322929343131292932333329292929292900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2929292929292929292929292929292929292929292929292900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
292929292929292929292929292929292929292929290f1f2900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
292929292929292929292929292929292929292929292f2f2900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2929292929292929101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2903040506171729101010101010100010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2913141516252629000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2923242526252629000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01100000100000e05011000090421100011050130000e04010000110501000000042100520000005040110500c00011040000501000000040100000c050130400000013050000000404011050130000704211000
011000000c0530c0530c0130c0130c0530c0530c0130c0130c0530c0130c0530c0130c0530c0130c0530c0530c0130c0530c0130c0530c0130c0530c0130c0530c0130c0530c0130c0530c0130c0130c0130c053
01100000180221a0221c0201d0201c0221d022180201c022180221d0221c0201c0201d0221d0211f0201d0221c0221d022180201c0201d0221c0221c0211d0221d02218022180211c0201c0221c0221d0221d021
__music__
00 01424244
00 00414344
01 00014244
00 00014244
00 00010244
02 00010244

