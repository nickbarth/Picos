pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- pico snake

title=1
game=2
gameover=3

state=title

function start_game()
	snake_new()
	apple_new()
	score=0
	bombs={}
	bomb_timer()
	state=game
	sfx(0)
end

function _init()
 poke(0x5f2c, 3)
 snake_new()
 apple_new()
end

function _update()
 if shake>0 then
  shake_update()
 end
 
 if state==title then
  if btnp(üÖæÔ∏è) then
   state=game
   sfx(0)
  end
  if btnp(‚ùé) then
   bomb_mode=true
   state=game
   sfx(0)
  end
 elseif state==game then
   snake_update()
   apple_update()
   sparks_update()
   
   if bomb_mode then
    bombs_update()
   end
 elseif state==gameover then
  snake_kill()
  sparks_update()
   
  if btnp(üÖæÔ∏è) then
   bomb_mode=false
   start_game()
  elseif btnp(‚ùé) then
   bomb_mode=true
   start_game()
  end
 end
end

function _draw()
 cls()
 snake_draw()
 border_draw()
 sparks_draw()
 apple_draw()
 bombs_draw()
 
 if state==title then
  title_draw()
 elseif state==game then
 	score_draw()
 elseif state==gameover then
  gameover_draw()
 end
end
-->8
-- snake

snake={}
speed=2
dx=0
dy=0

function snake_new()
 snake={{},{}}
 snake[1].x=rndp()
 snake[1].y=rndp()
 dx=0
 dy=0
end

function snake_update()
 if btnp(‚¨ÜÔ∏è) then
  dy=-speed
  dx=0
 elseif btnp(‚¨áÔ∏è) then
  dy=speed
  dx=0
 elseif btnp(‚¨ÖÔ∏è) then
  dx=-speed
  dy=0
 elseif btnp(‚û°Ô∏è) then
  dx=speed
  dy=0
 end
 
 for n=#snake,2,-1 do
  snake[n].x=snake[n-1].x
  snake[n].y=snake[n-1].y
 end
 
 snake[1].x+=dx
 snake[1].y+=dy
 
 snake_gameover_check()
end

function snake_gameover_check()
 -- snake self collision
 for n=4,#snake-1 do
  if collision(snake[1],snake[n]) then
   state=gameover
  end
 end

 -- snake bounds collision
 if snake[1].x<0 or
    snake[1].x>57 or 
    snake[1].y<0 or
    snake[1].y>57
 then
  state=gameover
 end
 
 if state==gameover then
  shake=0.5
 end
end

function snake_kill()
 if #snake>1 then
  spark_new(snake[1].x+4,snake[1].y+4)
  del(snake,snake[1])
  shake=0.5
  sfx(1)
 end
end

function snake_draw()
 for n=1,#snake-1 do
  spr(1,snake[n].x,snake[n].y)
 end
end
-->8
-- apple

apple={}

function apple_new()
 apple.x=rndp()
 apple.y=rndp()
end

function apple_update()
 if collision(apple,snake[1]) then
  shake=0.4
  spark_new(apple.x+4,apple.y+4)
  apple_new()
  score=score+1
  add(snake,{{x=0},{y=0}})
  sfx(0)
 end
end

function apple_draw()
 spr(2,apple.x,apple.y)
end
-->8
-- extra

shake=0
score=0

function collision(obj, other)
 if  other.x+4 > obj.x
 and other.y+4 > obj.y
 and other.x < obj.x+4
 and other.y < obj.y+4
 then
  return true
 end
end

function rndp(obj)
 return flr(rnd(40))+11
end

function shake_update()
 local sx=rnd(shake)-(shake/2)
 local sy=rnd(shake)-(shake/2)
 
 camera(sx,sy)
 shake*=0.9
 
 if shake<0.3 then
  shake=0
  camera()
 end
end

function title_draw()
 print("pico snake",12,2,3)
 print("press üÖæÔ∏è",15,57,8)
end

function gameover_draw()
 print("gameover",14,2,3)
 if score<10 then
  print("0"..score,26,8,7)
 else
  print(score,26,8,7)
 end
 print("press üÖæÔ∏è",15,57,8)
end

function border_draw()
 rect(0,0,63,63,7)
end

function score_draw()
 print(score,2,2,7)
end
-->8
-- sparks
sparks={}

function spark_new(x,y)
 local spark={}
 
 for n=1,10 do
  add(sparks,{
   x=x,
   y=y,
   life=flr(rnd(5))+3,
   angle=rnd()
  })
 end
end

function sparks_update()
 for spark in all(sparks) do
  spark.life-=1
  spark.y+=sin(spark.angle)
  spark.x+=cos(spark.angle)
  
  if spark.life<1 then
   del(sparks,spark)
  end
 end
end

function sparks_draw()
 c={2,2,8,8,8,8,8}
 for spark in all(sparks) do
  pset(spark.x,spark.y,c[spark.life])
 end
end
-->8
-- bombs

bombs={}
bomb_time=flr(rnd(5))+3
bomb_mode=false

function bomb_new()
 add(bombs,{
  x=rndp(),
  y=rndp()
 })
end

function bomb_timer()
 bomb_time=flr(rnd(5))+score+3
end

function bombs_update()
 if score==bomb_time then
  bomb_new()
  bomb_timer()
 end
 
 for bomb in all(bombs) do
  if collision(bomb,snake[1]) then
   del(bombs,bomb)
   state=gameover
  end
 end
end

function bombs_draw()
 for bomb in all(bombs) do
  spr(3,bomb.x,bomb.y)
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000300000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700003333000083380000566500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000003333000088880000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000003333000088880000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700003333000088880000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000033333300333333000033330000333300000000000033330033330000333333003300330033333300000000000000000000000077
77000000000000000000000033333300333333000033330000333300000000000033330033330000333333003300330033333300000000000000000000000077
77000000000000000000000033003300003300003300000033003300000000003300000033003300330033003300330033000000000000000000000000000077
77000000000000000000000033003300003300003300000033003300000000003300000033003300330033003300330033000000000000000000000000000077
77000000000000000000000033333300003300003300000033003300000000003333330033003300333333003333000033330000000000000000000000000077
77000000000000000000000033333300003300003300000033003300000000003333330033003300333333003333000033330000000000000000000000000077
77000000000000000000000033000000003300003300000033003300000000000000330033003300330033003300330033000000000000000000000000000077
77000000000000000000000033000000003300003300000033003300000000000000330033003300330033003300330033000000000000000000000000000077
77000000000000000000000033000000333333000033330033330000000000003333000033003300330033003300330033333300000000000000000000000077
77000000000000000000000033000000333333000033330033330000000000003333000033003300330033003300330033333300000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000883333880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000883333880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000888888880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000888888880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000888888880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000888888880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000888888880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000888888880000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000333333330000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000088888800888888008888880000888800008888000000000000888888888800000000000000000000000000000000000077
77000000000000000000000000000088888800888888008888880000888800008888000000000000888888888800000000000000000000000000000000000077
77000000000000000000000000000088008800880088008800000088000000880000000000000088880000008888000000000000000000000000000000000077
77000000000000000000000000000088008800880088008800000088000000880000000000000088880000008888000000000000000000000000000000000077
77000000000000000000000000000088888800888800008888000088888800888888000000000088880088008888000000000000000000000000000000000077
77000000000000000000000000000088888800888800008888000088888800888888000000000088880088008888000000000000000000000000000000000077
77000000000000000000000000000088000000880088008800000000008800000088000000000088880000008888000000000000000000000000000000000077
77000000000000000000000000000088000000880088008800000000008800000088000000000088880000008888000000000000000000000000000000000077
77000000000000000000000000000088000000880088008888880088880000888800000000000000888888888800000000000000000000000000000000000077
77000000000000000000000000000088000000880088008888880088880000888800000000000000888888888800000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777

__sfx__
0101000015020190211b03121051000003c2003c20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010100001d11017121151010910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
